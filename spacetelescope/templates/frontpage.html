{% extends "core.html" %}

{% load djangoplicity_datetime %}
{% load media_video %}
{% load pages %}
{% load i18n %}
{% load static %}

{% block extra_header %}
    <meta property="og:title" content="ESA/Hubble Space Telescope" />
    <meta property="og:description" content="The ESA page for the Hubble Space Telescope, the space-based observatory that has revolutionised modern astronomy." />
    <meta property="og:image" content="http://www.spacetelescope.org/static/archives/images/screen/hubble_earth_sp01.jpg" />
    <meta property="og:image:secure_url" content="https://www.spacetelescope.org/static/archives/images/screen/hubble_earth_sp01.jpg" />

    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v9.0" nonce="n9nP9JNb"></script>
    <script async src="https://platform.twitter.com/widgets.js" max-w charset="utf-8"></script>
{% endblock %}

{% block content_area %}
<div id="fb-root"></div>

<div id="pr-carousel-wrapper">
    <div id="pr-carousel">
        {% for release in releases %}
        <div class="slide">
            <a href="{{ release.get_absolute_url }}">
            {% if release.main_image.resource_banner1920 %}
                <img draggable="false" data-lazy="{{ release.main_image.resource_banner1920.url }}" alt="{{ release.main_image.title }}">
            {% else %}
                <img draggable="false" data-lazy="{{ release.main_image.resource_wallpaper3.url }}" alt="{{ release.main_image.title }}">
            {% endif %}
            <div class="pr-content">
                <div class="pr-description">
                    <div class="pr-type">{{ release.id }} — {{ release.release_type.name }}</div>
                    <div class="pr-title">{{ release.title }}</div>
                    <div class="pr-extra">
                        <div class="pr-headline">{{ release.headline }}</div>
                    </div>
                </div>
            </div>
            </a>
        </div>  <!-- slide -->
        {% endfor %}
    </div> <!-- pr-carousel -->
</div> <!-- pr-carousel-wrapper -->

<div class="container" id="body">

{% embed_page_no_unpublished frontpage_main %}

{% if announcements %}
<div class="row announcements">
    <div class="col-md-12">
        <div id="ann-carousel-wrapper">
            <div class="section-header">
                <div class="section-title">
                    <a href="{% url 'announcements_defaultquery' %}">{% trans 'What\'s New' %}</a>
                </div>
                <div class="section-navigation">
                </div>
            </div>
            <div id="ann-carousel">
                {% for announcement in announcements %}
                <div class="slide">
                    <a href="{{ announcement.get_absolute_url }}">
                        <div class="ann-description">
                            <div class="title">{{ announcement.title }}</div>
                            <div class="date">{{ announcement.release_date|date:"j N Y" }} — {{ announcement.id }}</div>
                        </div>
                        <img draggable="false" data-lazy="{{ announcement.main_visual.resource_thumb350x.url }}" alt="{{ announcement.main_visual.title }}">
                        <div class="readmore"></div>
                    </a>
                </div> <!-- slide -->
                {% endfor %}
            </div> <!-- ann-carousel -->
        </div> <!-- ann-carousel-wrapper -->
    </div>
</div> <!-- announcements -->
{% endif %}

<div class="row frontpage-section middle-section">
    <div class="col-md-8">
        {% if potws %}
        <div id="potw-carousel-wrapper">
            <div class="section-header">
                <div class="section-title">
                    <a href="{% url 'potw_defaultquery' %}">{% trans "Picture of the Week" %}</a>
                </div>
                <div class="section-navigation">
                </div>
            </div>
            <div id="potw-carousel">
                {% for potw in potws %}
                <div class="slide">
                    <a href="{{ potw.get_absolute_url }}">
                        <img draggable="false" data-lazy="{{ potw.visual.resource_screen640.url }}" class="img-responsive" alt="{{ potw.visual.title }}">
                        <div class="potw-description">
                            <div class="date">{{ potw.release_date|datetime:"DATE" }} — {{ potw.id }}</div>
                            <div class="title">{{ potw.visual.title }}</div>
                        </div>
                    </a>
                </div> <!-- slide -->
                {% endfor %}
            </div> <!-- potw-carousel -->
        </div>
        {% endif %}
        {% if hubblecasts %}
        <div id="hubblecast-carousel-wrapper">
            <div class="section-header">
                <div class="section-title">
                    <a href="{% url 'videos_query_category' 'hubblecast' %}">{% trans "Hubblecast" %}</a>
                </div>
                <div class="section-navigation">
                </div>
            </div>
            <div id="hubblecast-carousel">
                <div class="slide">
                    {% if hubblecasts.0.youtube_video_id and hubblecasts.0.use_youtube %}
                        <div class="youtube-wrapper">
                            <div id="youtube-player"></div>
                        </div>
                    {% else %}
                        {% embedvideo_subs hubblecasts.0 'medium_podcast,h264' 'hd_and_apple,hd720p_screen,dome_preview' '' hubblecasts.0.videosubtitle_set.all 0 %}
                    {% endif %}
                    <a href="{{ hubblecasts.0.get_absolute_url }}">
                        <div class="hubblecast-description{% if not hubblecasts.0.youtube_video_id or not hubblecasts.0.use_youtube %} hubblecast-description-jwplayer{% endif %}">
                            <div class="date">{{ hubblecasts.0.release_date|datetime:"DATE" }} — {{ hubblecasts.0.id }}</div>
                            <div class="title">{{ hubblecasts.0.title }}</div>
                    </div>
                    </a>
                </div>
            </div> <!-- hubblecast-carousel -->
        </div>
        {% endif %}
        <div id="newsletter-preview-container">
            <div class="section-header">
                <div class="section-title">
                    <a href="newsletters/science">{% trans "ESA/Hubble science Newsletter" %}</a>
                </div>
            </div>
            <div id="newsletter-preview">
                <a href="{{ science_newsletter.get_absolute_url }}">
                    <div class="img-wrapper">
                        <img draggable="false" src="{{ science_newsletter.resource_screen.url }}" class="img-cropped" alt="Newsletter">
                    </div>
                    <div class="newsletter-description">
                        <div class="title">{{ science_newsletter.subject }}</div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="social-feeds">
            <div class="facebook-feeds">
                <div class="section-header">
                    <div class="section-title blue-title">
                        {% trans "ESA/Hubble Facebook" %}
                    </div>
                </div>
                <div
                    class="fb-page"
                    data-href="https://www.facebook.com/hubbleESA/"
                    data-tabs="timeline"
                    data-width="304"
                    data-height="625"
                    data-small-header="true"
                    data-hide-cover="false"
                    data-show-facepile="false"
                >
                    <blockquote cite="https://www.facebook.com/hubbleESA/" class="fb-xfbml-parse-ignore">
                        <a href="https://www.facebook.com/hubbleESA/">Hubble Space Telescope</a>
                    </blockquote>
                </div>
            </div>
            <div class="twitter-feeds">
                <div class="section-header">
                    <div class="section-title blue-title">
                        {% trans "ESA/Hubble on Twitter" %}
                    </div>
                </div>
                <a
                    class="twitter-timeline"
                    href="https://twitter.com/HUBBLE_space?ref_src=twsrc%5Etfw"
                    data-width="304"
                    data-height="625"
                >
                    Tweets by HUBBLE_space
                </a>
            </div>
        </div>
    </div>
</div>

{% if top100 %}
<div class="row top100">
    <div class="col-md-12">
        <div id="top100-frontpage-carousel-wrapper">
            <div class="section-header">
                <div class="section-title">
                    <a href="{% url 'images_query_top100' %}">{% trans "Top 100 Images" %}</a>
                </div>
                <div class="section-navigation">
                </div>
            </div>
            <div id="top100-frontpage-carousel">
                {% for image in top100 %}
                <div class="slide">
                    <a href="{{ image.get_absolute_url }}">
                        <div class="img-wrapper">
                            <img draggable="false" data-lazy="{{ image.resource_wallpaper1.url }}" class="img-responsive" alt="{{ image.title }}">
                        </div>
                        <div class="top100-description">
                            <div class="title">{{ image.title }}</div>
                        </div>
                    </a>
                </div> <!-- slide -->
                {% endfor %}
            </div> <!-- #top100-frontpage-carousel -->
        </div>
    </div>
</div>
{% endif %}

<div class="frontpage-section subscribe-to-hubble">
    <div>
        <div class="row">
            <div class="col-md-6">
                <div class="border">
                    <div class="section-header">
                        <div class="section-title blue-title">
                            {% trans "ESA/Hubble Newsletters" %}
                        </div>
                    </div>
                    <div id="subscribe-link">
                        <a href="/newsletters">
                            <img src="{% static 'frontpage/subscribe.jpg' %}" alt="Subscribe to Hubble news">
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="border">
                    <div class="section-header">
                        <div class="section-title blue-title">
                            {% trans "Link to Social Media Channels" %}
                        </div>
                    </div>
                    <div class="social-links">
                        <div class="icons">
                            <a href="http://www.facebook.com/HubbleESA"><div class="sprites-facebook_42px_flat"></div></a>
                            <a href="http://twitter.com/hubble_space"><div class="sprites-twitter_42px_flat"></div></a>
                            <a href="http://www.youtube.com/user/HubbleESA"><div class="sprites-youtube_42px_flat"></div></a>
                            <a href="http://itunes.apple.com/de/podcast/hubblecast-hd/id258935617 "><div class="sprites-apple_42px_flat"></div></a>
                            <a href="http://www.vimeo.com/hubbleesa"><div class="sprites-vimeo_42px_flat"></div></a>
                            <a href="http://www.flickr.com/photos/hubble_esa "><div class="sprites-flickr_42px_flat"></div></a>
                            <a href="https://www.instagram.com/hubbleesa/"><div class="sprites-instagram"></div></a>
                            <a href="https://www.linkedin.com/company/esahubble/"><div class="sprites-linkedin_42px_flat"></div></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</div> <!-- #body -->

{% endblock content_area %}

{% block extra_scripts %}
<script type="text/javascript">

// Load YouTube or JwPlayer
{% if hubblecasts.0 %}
    {% if hubblecasts.0.youtube_video_id and hubblecasts.0.use_youtube %}
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '263',
                width: '468',
                videoId: '{{ hubblecasts.0.youtube_video_id }}',
                playerVars: {
                    'modestbranding': 1,
                    'hl': '{{ LANGUAGE_CODE }}',
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                }
            });
            function onPlayerReady(event) {
                // event.target.setPlaybackQuality('large');
            }
        }
    {% endif %}
{% endif %}

$(document).ready(function(){
    {% if hubblecasts.0 %}
        {% if hubblecasts.0.youtube_video_id and hubblecasts.0.use_youtube %}
            var tag = document.createElement('script');

            tag.src = "https://www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        {% else %}
            setupVideoPlayer('{{ hubblecasts.0.id }}');
        {% endif %}
    {% endif %}

    {% comment %}
    Set hover target on pr-description, this cannot be done fully in CSS
    as the image is outside the pr-description and cannot be "attached"
    by the standard hover
    {% endcomment %}
    $('.pr-description').hover(function() {
        $(this).parents('.pr-content').prev('img').toggleClass('hover');
    });

    // Set the announcements titles to the same heights:
    var annTitleSelector = '#ann-carousel .ann-description .title';
    var maxAnnHeight = Math.max.apply(null, $(annTitleSelector).map(function ()
    {
        return $(this).height();
    }).get());
    $(annTitleSelector).height(maxAnnHeight);

});

</script>
{% endblock %}

{% block addthis %}
<!-- no addthis on frontpage -->
{% endblock %}
